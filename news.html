<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>News & Events — Balagaru Mutt</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <header class="site-header" role="banner">
    <div class="container header-inner">
      <div class="brand">
        <div class="logo-icon">
          <img src="images/image.png" alt="Narasimha Logo" />
        </div>
        <div class="brand-text">
          <div class="brand-main">BALAGARU MUTT</div>
          <div class="brand-sub">Sri Arya Akshobya teertha moola Samsthanam</div>
        </div>
      </div>

      <input id="nav-toggle" class="nav-toggle" type="checkbox" aria-hidden="true" />
      <label for="nav-toggle" class="nav-toggle-label" aria-hidden="true" title="Toggle navigation">
        <span class="hamburger"></span>
      </label>

      <nav class="site-nav" aria-label="Primary navigation">
        <a href="index.html" class="nav-item">Home</a>
        <a href="about.html" class="nav-item">About</a>
        <a href="parampara.html" class="nav-item">Parampara</a>
        <a href="news.html" class="nav-item active">News</a>
        <a href="gallery.html" class="nav-item">Gallery</a>
        <a href="contact.html" class="nav-item">Contact</a>
        <a href="admin/index.html" class="nav-item admin">Admin</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="page-header-section">
      <div class="container">
        <h1>News & Events</h1>
        <p class="page-subtitle">Stay updated with the latest activities and events at the Samsthanam</p>
      </div>
    </section>

    <section class="main-content-section">
      <div class="container">
        <div id="news-container">
          <p class="muted">Loading news…</p>
        </div>

        <article id="article-view" class="article-view" hidden>
          <a id="back-to-list" href="news.html" class="back-link">← Back to list</a>
          <div class="content-card">
            <h2 id="article-title"></h2>
            <div id="article-date" class="news-date"></div>
            <div id="article-body" class="article-body"></div>
          </div>
        </article>
      </div>
    </section>
  </main>

  <footer class="site-footer" role="contentinfo">
    <div class="container footer-inner">
      <div>
        <p>© <span id="year"></span> Sri Arya Akshobya teertha moola Samsthanam Balagaru</p>
        <p class="small-muted">Preserving tradition, serving community, spreading wisdom</p>
      </div>
      <div class="footer-contacts">
        <p class="small-muted">Phone: <span class="muted">+91‑XXXXXXXXXX</span></p>
        <p class="small-muted">Email: <a href="mailto:contact@balagarumutt.org">contact@balagarumutt.org</a></p>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    function formatDate(d) {
      try {
        return new Date(d).toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
      } catch (e) { return d; }
    }

    function loadNewsList() {
      fetch('/content/news/index.json')
        .then(function (r) {
          if (!r.ok) throw new Error('No news index');
          return r.json();
        })
        .then(function (data) {
          if (!Array.isArray(data) || data.length === 0) {
            document.getElementById('news-container').innerHTML = '<p class="muted">No news available.</p>';
            return;
          }
          data.sort(function (a, b) { return new Date(b.date) - new Date(a.date); });

          var container = document.getElementById('news-container');
          container.innerHTML = '';
          var grid = document.createElement('div');
          grid.className = 'news-grid';
          
          data.forEach(function (item) {
            var card = document.createElement('article');
            card.className = 'news-card';
            var title = document.createElement('h4');
            var link = document.createElement('a');
            link.href = 'news.html?file=' + encodeURIComponent(item.file);
            link.textContent = item.title;
            title.appendChild(link);
            var date = document.createElement('div');
            date.className = 'news-date';
            date.textContent = formatDate(item.date);
            var excerpt = document.createElement('p');
            excerpt.textContent = item.excerpt || '';
            card.appendChild(title);
            card.appendChild(date);
            card.appendChild(excerpt);
            grid.appendChild(card);
          });
          
          container.appendChild(grid);
        })
        .catch(function () {
          document.getElementById('news-container').innerHTML = '<p class="muted">No news index found. Use the admin at /admin to add news.</p>';
        });
    }

    function loadArticle(file) {
      var articleView = document.getElementById('article-view');
      var container = document.getElementById('article-body');
      fetch('/content/news/' + file)
        .then(function (r) {
          if (!r.ok) throw new Error('Article not found');
          return r.text();
        })
        .then(function (txt) {
          var body = txt;
          var front = {};
          if (txt.startsWith('---')) {
            var end = txt.indexOf('---', 3);
            if (end !== -1) {
              var fm = txt.substring(3, end).trim();
              body = txt.substring(end + 3).trim();
              fm.split('\n').forEach(function (line) {
                var idx = line.indexOf(':');
                if (idx > -1) {
                  var k = line.substring(0, idx).trim();
                  var v = line.substring(idx + 1).trim();
                  v = v.replace(/^["']|["']$/g, '');
                  front[k] = v;
                }
              });
            }
          }
          var title = front.title || 'Article';
          var date = front.date || '';
          document.getElementById('article-title').textContent = title;
          document.getElementById('article-date').textContent = date ? formatDate(date) : '';
          container.innerHTML = marked.parse(body);
          document.getElementById('news-container').hidden = true;
          articleView.hidden = false;
          articleView.scrollIntoView({ behavior: 'smooth' });
        })
        .catch(function () {
          alert('Unable to load the article.');
          window.location.href = 'news.html';
        });
    }

    (function init() {
      var params = new URLSearchParams(window.location.search);
      var file = params.get('file');
      if (file) {
        loadArticle(file);
      } else {
        loadNewsList();
      }
      var back = document.getElementById('back-to-list');
      if (back) {
        back.addEventListener('click', function (e) {
          e.preventDefault();
          document.getElementById('article-view').hidden = true;
          document.getElementById('news-container').hidden = false;
          history.replaceState(null, '', 'news.html');
        });
      }
    })();
  </script>
</body>
</html>
